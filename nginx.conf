server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    # Rewrite: redirecionar path antigo de fontes do Expo para /fonts/
    # O JS bundle referencia o path profundo — este rewrite faz funcionar
    rewrite ^/assets/node_modules/@expo/vector-icons/build/vendor/react-native-vector-icons/Fonts/(.+)$ /fonts/$1 last;

    # Servir fontes com MIME type correto e CORS
    location ~* \.(ttf|otf|eot|woff2?)$ {
        expires 30d;
        access_log off;
        add_header Access-Control-Allow-Origin *;
        types {
            font/ttf   ttf;
            font/otf   otf;
            font/woff  woff;
            font/woff2 woff2;
            application/vnd.ms-fontobject eot;
        }
    }

    # Cache para assets estáticos (JS, CSS, imagens)
    location ~* \.(js|css|png|jpg|jpeg|gif|svg|ico|json)$ {
        expires 30d;
        access_log off;
    }

    # SPA fallback — todas as rotas caem no index.html
    location / {
        try_files $uri $uri/ /index.html;
    }
}
